<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="
This function will likely be replaced in future harp versions since it is
rather cumbersome. Some thought still needs to go into finding a more usable
API.
This is a wrapper for the verification process. Forecasts and observations
are read in, filtered down to common cases, errors checked, and a full
verification is done for all scores. To minimise memory usage, the
verification can be done for one lead time at time. It would also be possible
to parallelise the process using for example mclapply, or
future_map."><title>Read forecast and observations and verify. — ens_read_and_verify • harpPoint</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Read forecast and observations and verify. — ens_read_and_verify"><meta property="og:description" content="
This function will likely be replaced in future harp versions since it is
rather cumbersome. Some thought still needs to go into finding a more usable
API.
This is a wrapper for the verification process. Forecasts and observations
are read in, filtered down to common cases, errors checked, and a full
verification is done for all scores. To minimise memory usage, the
verification can be done for one lead time at time. It would also be possible
to parallelise the process using for example mclapply, or
future_map."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">harpPoint</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/harphub/harpPoint/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Read forecast and observations and verify.</h1>
      <small class="dont-index">Source: <a href="https://github.com/harphub/harpPoint/blob/HEAD/R/ens_read_and_verify.R" class="external-link"><code>R/ens_read_and_verify.R</code></a></small>
      <div class="d-none name"><code>ens_read_and_verify.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><a href="https://lifecycle.r-lib.org/articles/stages.html#questioning" class="external-link"><img src="figures/lifecycle-questioning.svg" alt="[Questioning]"></a></p>
<p>This function will likely be replaced in future harp versions since it is
rather cumbersome. Some thought still needs to go into finding a more usable
API.</p>
<p>This is a wrapper for the verification process. Forecasts and observations
are read in, filtered down to common cases, errors checked, and a full
verification is done for all scores. To minimise memory usage, the
verification can be done for one lead time at time. It would also be possible
to parallelise the process using for example <a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a>, or
future_map.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">ens_read_and_verify</span><span class="op">(</span></span>
<span>  <span class="va">start_date</span>,</span>
<span>  <span class="va">end_date</span>,</span>
<span>  <span class="va">parameter</span>,</span>
<span>  <span class="va">fcst_model</span>,</span>
<span>  <span class="va">fcst_path</span>,</span>
<span>  <span class="va">obs_path</span>,</span>
<span>  lead_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">48</span>, <span class="fl">3</span><span class="op">)</span>,</span>
<span>  num_iterations <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">lead_time</span><span class="op">)</span>,</span>
<span>  verify_members <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thresholds <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  members <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vertical_coordinate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA_character_</span>, <span class="st">"pressure"</span>, <span class="st">"model"</span>, <span class="st">"height"</span><span class="op">)</span>,</span>
<span>  fctable_file_template <span class="op">=</span> <span class="st">"fctable"</span>,</span>
<span>  obsfile_template <span class="op">=</span> <span class="st">"obstable"</span>,</span>
<span>  groupings <span class="op">=</span> <span class="st">"lead_time"</span>,</span>
<span>  by <span class="op">=</span> <span class="st">"6h"</span>,</span>
<span>  lags <span class="op">=</span> <span class="st">"0s"</span>,</span>
<span>  merge_lags_on_read <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  lag_fcst_models <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parent_cycles <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  lag_direction <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  fcst_shifts <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  keep_unshifted <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  drop_neg_leadtimes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  climatology <span class="op">=</span> <span class="st">"sample"</span>,</span>
<span>  stations <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_fcst <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scale_obs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spread_drop_member <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  jitter_fcst <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  common_cases_only <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  common_cases_xtra_cols <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  check_obs_fcst <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  gross_error_check <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  min_allowed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_allowed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  num_sd_allowed <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  show_progress <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  verif_path <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>start_date</dt>
<dd><p>Start date to for the verification. Should be numeric or
character. YYYYMMDD(HH)(mm).</p></dd>


<dt>end_date</dt>
<dd><p>End date for the verification. Should be numeric or
character.</p></dd>


<dt>parameter</dt>
<dd><p>The parameter to verify.</p></dd>


<dt>fcst_model</dt>
<dd><p>The forecast model(s) to verify. Can be a single string or
a character vector of model names.</p></dd>


<dt>fcst_path</dt>
<dd><p>The path to the forecast FCTABLE files.</p></dd>


<dt>obs_path</dt>
<dd><p>The path to the observation OBSTABLE files.</p></dd>


<dt>lead_time</dt>
<dd><p>The lead times to verify.</p></dd>


<dt>num_iterations</dt>
<dd><p>The number of iterations per verification calculation.
The default is to do the same number of iterations as there are lead times.
If a small number of iterations is set, it may be useful to set
<code>show_progress = TRUE</code>. The higher the number of iterations, the
smaller the amount of data that is held in memory at any one time.</p></dd>


<dt>verify_members</dt>
<dd><p>Whether to verify the individual members of the
ensemble. Even if thresholds are supplied, only summary scores are
computed. If you wish to compute categorical scores, the separate
<a href="det_verify.html">det_verify</a> function must be used.</p></dd>


<dt>thresholds</dt>
<dd><p>The thresholds to compute categorical scores for.</p></dd>


<dt>members</dt>
<dd><p>The members to retrieve if reading an EPS forecast. To select
the same members for all forecast models, this should be a numeric vector.
For specific members from specific models a named list with each element
having the name of the forecast model and containing a a numeric vector.
e.g. <br><code>members = list(eps_model1 = seq(0, 3), eps_model2 = c(2,
  3))</code>. <br> For multi model ensembles, each element of this named list should
contain another named list with sub model name followed by the desired
members, e.g. <br><code>members = list(eps_model1 = list(sub_model1 =
  seq(0, 3), sub_model2 = c(2, 3)))</code></p></dd>


<dt>vertical_coordinate</dt>
<dd><p>The vertical co-ordinate.</p></dd>


<dt>fctable_file_template</dt>
<dd><p>The template for the file names of the files to be read
from. This would normally be one of the "fctable_*" templates that can be
seen in show_file_templates. Can be a single string, a
character vector or list of the same length as <code>fcst_model</code>. If not
named, the order of templates is assumed to be the same as in
<code>fcst_model</code>. If named, the names must match the entries in
<code>fcst_model</code>.</p></dd>


<dt>obsfile_template</dt>
<dd><p>The template for OBSTABLE files - the default is
"obstable", which is <code>OBSTABLE_{YYYY}.sqlite</code>.</p></dd>


<dt>groupings</dt>
<dd><p>The groups to verify for. The default is "leadtime". Another
common grouping might be <code>groupings = c("leadtime", "fcst_cycle")</code>.</p></dd>


<dt>by</dt>
<dd><p>The frequency of forecast cycles to verify.</p></dd>


<dt>lags</dt>
<dd><p>For lagged forecasts, these are the lags that would be passed to
<code>read_point_forecast()</code>.</p></dd>


<dt>merge_lags_on_read</dt>
<dd><p>Logical. Whether to merge lagged ensemble members
into the ensemble. This is the default behaviour. If FALSE,
<a href="lag_forecast.html">lag_forecast</a> will be used to do the lagging.</p></dd>


<dt>lag_fcst_models</dt>
<dd><p>If <code>merge_lags_on_read = FALSE</code>, the names of the
fcst_models to which lags should be applied.</p></dd>


<dt>parent_cycles</dt>
<dd><p>If <code>merge_lags_on_read = FALSE</code>, the parent cycles of
the lagged forecasts.</p></dd>


<dt>lag_direction</dt>
<dd><p>If <code>merge_lags_on_read = FALSE</code>, The direction of the
lagging. 1 Lags backwards in time from the parent cycles on -1 lags
forwards in time.</p></dd>


<dt>fcst_shifts, keep_unshifted</dt>
<dd><p>See <a href="shift_forecast.html">shift_forecast</a>.</p></dd>


<dt>drop_neg_leadtimes</dt>
<dd><p>Logical. Whether to drop negative lead times that
may arise after shifting.</p></dd>


<dt>climatology</dt>
<dd><p>The climatology to use for the Brier Skill Score. Can be
"sample" for the sample climatology (the default), a named list with
elements eps_model and member to use a member of an eps model in the
harp_fcst object for the climatology, or a data frame with columns for
threshold and climatology and also optionally leadtime.</p></dd>


<dt>stations</dt>
<dd><p>The stations to verify for. The default is to use all
stations from station_list that are common to all
<code>fcst_model</code> domains.</p></dd>


<dt>scale_fcst</dt>
<dd><p>A named list of arguments to <a href="scale_point_forecast.html">scale_point_forecast</a>.</p></dd>


<dt>scale_obs</dt>
<dd><p>A names list of arguments to <a href="scale_point_obs.html">scale_point_obs</a>.</p></dd>


<dt>spread_drop_member</dt>
<dd><p>Which members to drop for the calculation of the
ensemble variance and standard deviation. For harp_fcst objects, this can
be a numeric scalar - in which case it is recycled for all forecast models;
a list or numeric vector of the same length as the harp_fcst object, or a
named list with the names corresponding to names in the harp_fcst object.</p></dd>


<dt>jitter_fcst</dt>
<dd><p>A function to perturb the forecast values by. This is used
to account for observation error in the rank histogram. For other
statistics it is likely to make little difference since it is expected that
the observations will have a mean error of zero.</p></dd>


<dt>common_cases_only</dt>
<dd><p>Logical. Whether to select only the common cases
before computing verification scores. The default is TRUE.</p></dd>


<dt>common_cases_xtra_cols</dt>
<dd><p>Extra columns to use in the call to
<code><a href="https://rdrr.io/pkg/harpCore/man/common_cases.html" class="external-link">common_cases</a></code></p></dd>


<dt>check_obs_fcst</dt>
<dd><p>Logical. Whether to check for errors in observations
by comparing with forecast values.</p></dd>


<dt>gross_error_check</dt>
<dd><p>Logical of whether to perform a gross error check.</p></dd>


<dt>min_allowed</dt>
<dd><p>The minimum value of observation to allow in the gross
error check. If set to NULL the default value for the parameter is used.</p></dd>


<dt>max_allowed</dt>
<dd><p>The maximum value of observation to allow in the gross
error check. If set to NULL the default value for the parameter is used.</p></dd>


<dt>num_sd_allowed</dt>
<dd><p>The number of standard deviations of the forecast that
the obseravtions should be within. Set to NULL for automotic value
depeninding on parameter.</p></dd>


<dt>show_progress</dt>
<dd><p>Logical - whether to show a progress bar. Defaults to
FALSE.</p></dd>


<dt>verif_path</dt>
<dd><p>If set, verification files will be saved to this path.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>A list containing two data frames: <code>ens_summary_scores</code> and
<code>ens_threshold_scores</code>.</p>
    </div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Andrew Singleton, Alex Deckmyn.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

